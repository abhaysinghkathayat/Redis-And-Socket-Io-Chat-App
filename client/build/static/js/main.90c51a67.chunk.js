(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{129:function(e,t,s){"use strict";s.r(t);var n=s(0),a=(s(68),s(69),s(70),s(71),s(1)),c=s(22),r=s.n(c),o=s(2),i=s(3),l=s(4),d=s.n(l),u=s(8),j=s(135),b=function(e){var t=e.width,s=void 0===t?64:t,a=e.height,c=void 0===a?64:a;return Object(n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 32 32",height:c,width:s,children:[Object(n.jsx)("script",{}),Object(n.jsxs)("defs",{children:[Object(n.jsx)("path",{id:"prefix__a",d:"M45.536 38.764c-2.013 1.05-12.44 5.337-14.66 6.494s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276c-1-.478-1.524-.88-1.524-1.26v-3.813s14.447-3.145 16.78-3.982 3.14-.867 5.126-.14 13.853 2.868 15.814 3.587v3.76c0 .377-.452.8-1.477 1.324z"}),Object(n.jsx)("path",{id:"prefix__b",d:"M45.536 28.733c-2.013 1.05-12.44 5.337-14.66 6.494s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276-2.04-1.613-.077-2.382l15.332-5.935c2.332-.837 3.14-.867 5.126-.14s12.35 4.853 14.312 5.57 2.037 1.31.024 2.36z"})]}),Object(n.jsxs)("g",{transform:"matrix(.84833 0 0 .84833 -7.884 -9.45)",children:[Object(n.jsx)("use",{fill:"#a41e11",xlinkHref:"#prefix__a"}),Object(n.jsx)("path",{d:"M45.536 34.95c-2.013 1.05-12.44 5.337-14.66 6.494s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276-2.04-1.613-.077-2.382l15.332-5.936c2.332-.836 3.14-.867 5.126-.14S43.55 31.87 45.51 32.6s2.037 1.31.024 2.36z",fill:"#d82c20"}),Object(n.jsx)("use",{fill:"#a41e11",xlinkHref:"#prefix__a",y:-6.218}),Object(n.jsx)("use",{fill:"#d82c20",xlinkHref:"#prefix__b"}),Object(n.jsx)("path",{d:"M45.536 26.098c-2.013 1.05-12.44 5.337-14.66 6.495s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276c-1-.478-1.524-.88-1.524-1.26V21.55s14.447-3.145 16.78-3.982 3.14-.867 5.126-.14 13.853 2.868 15.814 3.587v3.76c0 .377-.452.8-1.477 1.324z",fill:"#a41e11"}),Object(n.jsx)("use",{fill:"#d82c20",xlinkHref:"#prefix__b",y:-6.449}),Object(n.jsxs)("g",{fill:"#fff",children:[Object(n.jsx)("path",{d:"M29.096 20.712l-1.182-1.965-3.774-.34 2.816-1.016-.845-1.56 2.636 1.03 2.486-.814-.672 1.612 2.534.95-3.268.34zM22.8 24.624l8.74-1.342-2.64 3.872z"}),Object(n.jsx)("ellipse",{cx:20.444,cy:21.402,rx:4.672,ry:1.811})]}),Object(n.jsx)("path",{d:"M42.132 21.138l-5.17 2.042-.004-4.087z",fill:"#7a0c00"}),Object(n.jsx)("path",{d:"M36.963 23.18l-.56.22-5.166-2.042 5.723-2.264z",fill:"#ad2115"})]})]})},m=(s(76),["Pablo","Joe","Mary","Alex"]);function f(e){var t=e.onLogIn,s=Object(a.useState)((function(){return m[Math.floor(Math.random()*m.length)]})),c=Object(i.a)(s,2),r=c[0],o=c[1],l=Object(a.useState)("password123"),f=Object(i.a)(l,2),O=f[0],p=f[1],x=Object(a.useState)(null),g=Object(i.a)(x,2),v=g[0],y=g[1],N=function(){var e=Object(u.a)(d.a.mark((function e(s){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s.preventDefault(),t(r,O,y);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(n.jsx)(n.Fragment,{children:Object(n.jsx)("div",{className:"login-form text-center login-page",children:Object(n.jsxs)("div",{className:"rounded",style:{boxShadow:"0 0.75rem 1.5rem rgba(18,38,63,.03)"},children:[Object(n.jsxs)("div",{className:"position-relative",children:[Object(n.jsxs)("div",{className:"row no-gutters align-items-center",style:{maxWidth:400,backgroundColor:"rgba(85, 110, 230, 0.25)",paddingLeft:20,paddingRight:20,borderTopLeftRadius:4,borderTopRightRadius:4},children:[Object(n.jsxs)("div",{className:"col text-primary text-left",children:[Object(n.jsx)("h3",{className:"font-size-15",children:"Welcome Back !"}),Object(n.jsx)("p",{children:"Sign in to continue"})]}),Object(n.jsx)("div",{className:"col align-self-end",children:Object(n.jsx)("img",{alt:"welcome back",style:{maxWidth:"100%"},src:"".concat("","/welcome-back.png")})})]}),Object(n.jsx)("div",{className:"position-absolute",style:{bottom:-36,left:20},children:Object(n.jsx)("div",{style:{backgroundColor:"rgb(239, 242, 247)",width:72,height:72},className:"rounded-circle d-flex align-items-center justify-content-center",children:Object(n.jsx)(b,{width:34,height:34})})})]}),Object(n.jsxs)("form",{className:"bg-white text-left px-4",style:{paddingTop:58,borderBottomLeftRadius:4,borderBottomRightRadius:4},onSubmit:N,children:[Object(n.jsx)("label",{className:"font-size-12",children:"Name"}),Object(n.jsx)("div",{className:"username-select mb-3",children:Object(n.jsx)(h,{username:r,setUsername:o,names:m})}),Object(n.jsx)("label",{htmlFor:"inputPassword",className:"font-size-12",children:"Password"}),Object(n.jsx)("input",{value:O,onChange:function(e){return p(e.target.value)},type:"password",id:"inputPassword",className:"form-control",placeholder:"Password",required:!0}),Object(n.jsx)("div",{style:{height:30}}),Object(n.jsx)("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",children:"Sign in"}),Object(n.jsx)("div",{className:"login-error-anchor",children:Object(n.jsx)("div",{className:"toast-box",children:Object(n.jsxs)(j.a,{style:{minWidth:277},onClose:function(){return y(null)},show:null!==v,delay:3e3,autohide:!0,children:[Object(n.jsxs)(j.a.Header,{children:[Object(n.jsx)("img",{src:"holder.js/20x20?text=%20",className:"rounded mr-2",alt:""}),Object(n.jsx)("strong",{className:"mr-auto",children:"Error"})]}),Object(n.jsx)(j.a.Body,{children:v})]})})}),Object(n.jsx)("div",{style:{height:30}})]})]})})})}var h=function(e){var t,s=e.username,c=e.setUsername,r=e.names,o=void 0===r?[""]:r,l=Object(a.useState)(!1),d=Object(i.a)(l,2),u=d[0],j=d[1],b=Object(a.useState)(0),m=Object(i.a)(b,2),f=m[0],h=m[1],O=Object(a.useRef)(),p=null===(t=O.current)||void 0===t?void 0:t.getBoundingClientRect().width;return Object(a.useEffect)((function(){h(p)}),[p]),Object(a.useEffect)((function(){if(u){var e=function(){return j(!1)};return document.addEventListener("click",e),function(){return document.removeEventListener("click",e)}}}),[u]),Object(a.useEffect)((function(){var e;u&&(null===(e=O.current)||void 0===e||e.focus())}),[u]),Object(n.jsxs)("div",{tabIndex:0,ref:O,className:"username-select-dropdown ".concat(u?"open":""),onClick:function(){return j((function(e){return!e}))},children:[Object(n.jsxs)("div",{className:"username-select-row",children:[Object(n.jsx)("div",{children:s}),Object(n.jsx)("div",{children:Object(n.jsx)("svg",{width:24,height:24,children:Object(n.jsx)("path",{d:"M7 10l5 5 5-5z",fill:"#333"})})})]}),Object(n.jsx)("div",{style:{width:f},className:"username-select-block ".concat(u?"open":""),children:o.map((function(e){return Object(n.jsx)("div",{className:"username-select-block-item",onClick:function(){return c(e)},children:e},e)}))})]})},O=s(18),p=(s(79),s(12)),x=function(e,t){switch(t.type){case"clear":return{currentRoom:"0",rooms:{},users:{}};case"set user":return Object(o.a)(Object(o.a)({},e),{},{users:Object(o.a)(Object(o.a)({},e.users),{},Object(p.a)({},t.payload.id,t.payload))});case"make user online":return Object(o.a)(Object(o.a)({},e),{},{users:Object(o.a)(Object(o.a)({},e.users),{},Object(p.a)({},t.payload,Object(o.a)(Object(o.a)({},e.users[t.payload]),{},{online:!0})))});case"append users":return Object(o.a)(Object(o.a)({},e),{},{users:Object(o.a)(Object(o.a)({},e.users),t.payload)});case"set messages":return Object(o.a)(Object(o.a)({},e),{},{rooms:Object(o.a)(Object(o.a)({},e.rooms),{},Object(p.a)({},t.payload.id,Object(o.a)(Object(o.a)({},e.rooms[t.payload.id]),{},{messages:t.payload.messages,offset:t.payload.messages.length})))});case"prepend messages":var s=[].concat(Object(O.a)(t.payload.messages),Object(O.a)(e.rooms[t.payload.id].messages));return Object(o.a)(Object(o.a)({},e),{},{rooms:Object(o.a)(Object(o.a)({},e.rooms),{},Object(p.a)({},t.payload.id,Object(o.a)(Object(o.a)({},e.rooms[t.payload.id]),{},{messages:s,offset:s.length})))});case"append message":return void 0===e.rooms[t.payload.id]?e:Object(o.a)(Object(o.a)({},e),{},{rooms:Object(o.a)(Object(o.a)({},e.rooms),{},Object(p.a)({},t.payload.id,Object(o.a)(Object(o.a)({},e.rooms[t.payload.id]),{},{lastMessage:t.payload.message,messages:e.rooms[t.payload.id].messages?[].concat(Object(O.a)(e.rooms[t.payload.id].messages),[t.payload.message]):void 0})))});case"set last message":return Object(o.a)(Object(o.a)({},e),{},{rooms:Object(o.a)(Object(o.a)({},e.rooms),{},Object(p.a)({},t.payload.id,Object(o.a)(Object(o.a)({},e.rooms[t.payload.id]),{},{lastMessage:t.payload.lastMessage})))});case"set current room":return Object(o.a)(Object(o.a)({},e),{},{currentRoom:t.payload});case"add room":return Object(o.a)(Object(o.a)({},e),{},{rooms:Object(o.a)(Object(o.a)({},e.rooms),{},Object(p.a)({},t.payload.id,t.payload))});case"set rooms":var n=t.payload,a=Object(o.a)({},e.rooms);return n.forEach((function(e){a[e.id]=Object(o.a)(Object(o.a)({},e),{},{messages:a[e.id]&&a[e.id].messages})})),Object(o.a)(Object(o.a)({},e),{},{rooms:a});default:return e}},g={currentRoom:"main",rooms:{},users:{}},v=Object(a.createContext)(),y=function(){var e=Object(a.useContext)(v),t=Object(i.a)(e,2);return[t[0],t[1]]},N=function(){return Object(a.useReducer)(x,g)},w=s(17),k=s.n(w),M=s(9),C=s.n(M);C.a.defaults.withCredentials=!0;var L=function(e){return"".concat("").concat(e)},z=function(){return C.a.get(L("/me")).then((function(e){return e.data})).catch((function(e){return null}))},S=function(e,t){return C.a.post(L("/login"),{username:e,password:t}).then((function(e){return e.data})).catch((function(e){throw new Error(e.response&&e.response.data&&e.response.data.message)}))},_=function(){return C.a.post(L("/logout"))},E=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15;return C.a.get(L("/room/".concat(e,"/messages")),{params:{offset:t,size:s}}).then((function(e){return e.data.reverse()}))},R=function(e){return C.a.get(L("/users"),{params:{ids:e}}).then((function(e){return e.data}))},I=function(){var e=Object(u.a)(d.a.mark((function e(t,s){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C.a.post(L("/room"),{user1:t,user2:s}).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e)})));return function(t,s){return e.apply(this,arguments)}}(),B=function(){var e=Object(u.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C.a.get(L("/rooms/".concat(t))).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=s(63),T=function(e,t){var s,n=Object(F.a)(e);try{for(n.s();!(s=n.n()).done;){var a=s.value;if("string"!==typeof a&&(a=a[0]),a!==t)return a}}catch(c){n.e(c)}finally{n.f()}return e[0]},U=(s(130),function(){var e=Object(u.a)(d.a.mark((function e(t,s,n){var a,c,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={},n.forEach((function(e){a[e.from]=1})),0===(c=Object.keys(a).filter((function(e){return void 0===t[e]}))).length){e.next=8;break}return e.next=6,R(c);case 6:r=e.sent,s({type:"append users",payload:r});case 8:case"end":return e.stop()}}),e)})));return function(t,s,n){return e.apply(this,arguments)}}()),H=function(){return Object(n.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 1651 1651",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(n.jsx)("rect",{width:"1651",height:"1651",rx:"14",fill:"white"}),Object(n.jsx)("path",{d:"M495.286 1098.96L497.967 1070.86L478.04 1050.88C408.572 981.233 368 891.771 368 795.344C368 585.371 565.306 402 826 402C1086.69 402 1284 585.371 1284 795.344C1284 1005.32 1086.69 1188.69 826 1188.69V1248.69L825.913 1188.69C779.837 1188.75 733.952 1182.77 689.432 1170.9L667.26 1164.98L646.8 1175.37C620.731 1188.61 562.74 1213.98 467.32 1235.35C480.554 1191.83 490.95 1144.39 495.286 1098.96Z",stroke:"url(#paint0_linear)",strokeWidth:"120"}),Object(n.jsx)("defs",{children:Object(n.jsxs)("linearGradient",{id:"paint0_linear",x1:"662.312",y1:"397.956",x2:"416.164",y2:"1678.7",gradientUnits:"userSpaceOnUse",children:[Object(n.jsx)("stop",{stopColor:"#7514FB"}),Object(n.jsx)("stop",{offset:"0.624243",stopColor:"#F26D41"}),Object(n.jsx)("stop",{offset:"1",stopColor:"#F43B4B"})]})})]})},P=function(e){var t=e.name,s=e.id,c=Object(a.useMemo)((function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1",t=13,s=654,n=531,a=+e.split(":").pop(),c=+e.split(":").reverse().pop();c<0&&(c+=3555);var r=(a*s+c*n)%t;return"".concat("","/avatars/").concat(r,".jpg")}(""+s);return"Mary"===t?"".concat("","/avatars/0.jpg"):"Pablo"===t?"".concat("","/avatars/2.jpg"):"Joe"===t?"".concat("","/avatars/9.jpg"):"Alex"===t?"".concat("","/avatars/8.jpg"):e}),[s,t]);return Object(n.jsx)(n.Fragment,{children:"General"!==t?Object(n.jsx)("img",{src:c,alt:t,style:{width:32,height:32,objectFit:"cover"},className:"rounded-circle avatar-xs"}):Object(n.jsx)("div",{className:"overflow-hidden rounded-circle",children:Object(n.jsx)(H,{})})})},W=function(e){var t=e.online,s=e.hide,a=void 0!==s&&s,c=e.width,r=void 0===c?8:c,o=e.height,i=void 0===o?8:o;return Object(n.jsx)("div",{className:t?"rounded-circle bg-success":"rounded-circle bg-gray",style:{width:r,height:i,opacity:a?0:1}})},D=function(e){var t=e.id,s=e.name,n=y(),c=Object(i.a)(n,1)[0],r=Object(a.useMemo)((function(){try{var e=Math.abs(parseInt(t.split(":").reverse().pop())),n=e>0,a=Object.entries(c.users).filter((function(e){return Object(i.a)(e,2)[1].username===s})).map((function(e){return Object(i.a)(e,2)[1]})),r=!1;return a.length>0&&(r=a[0].online,e=+a[0].id),[n,r,e]}catch(o){return[!1,!1,"0"]}}),[t,s,c.users]),o=Object(i.a)(r,3),l=o[0],d=o[1],u=o[2],j=A(e);return{isUser:l,online:d,userId:u,name:e.name,lastMessage:j}},A=function(e){var t=y(),s=Object(i.a)(t,2)[1],n=e.lastMessage;return Object(a.useEffect)((function(){void 0===n&&(void 0===e.messages?E(e.id,0,1).then((function(t){var n=null;0!==t.length&&(n=t.pop()),s({type:"set last message",payload:{id:e.id,lastMessage:n}})})):0===e.messages.length?s({type:"set last message",payload:{id:e.id,lastMessage:null}}):s({type:"set last message",payload:{id:e.id,lastMessage:e.messages[e.messages.length-1]}}))}),[n,s,e]),n},J=function(e){var t=e.room,s=e.active,a=void 0!==s&&s,c=e.onClick,r=D(t),o=r.online,i=r.name,l=r.lastMessage,d=r.userId;return Object(n.jsxs)("div",{onClick:c,className:"chat-list-item d-flex align-items-start rounded ".concat(a?"bg-white":""),children:[Object(n.jsx)("div",{className:"align-self-center mr-3",children:Object(n.jsx)(W,{online:o,hide:"0"===t.id})}),Object(n.jsx)("div",{className:"align-self-center mr-3",children:Object(n.jsx)(P,{name:i,id:d})}),Object(n.jsxs)("div",{className:"media-body overflow-hidden",children:[Object(n.jsx)("h5",{className:"text-truncate font-size-14 mb-1",children:i}),l&&Object(n.jsxs)("p",{className:"text-truncate mb-0",children:[" ",l.message," "]})]}),l&&Object(n.jsx)("div",{className:"font-size-11",children:k.a.unix(l.date).format("LT")})]})},V=s(133),q=function(e){var t=e.onLogOut,s=e.col,a=void 0===s?5:s,c=e.noinfo,r=void 0!==c&&c;return Object(n.jsxs)("div",{onClick:t,style:{cursor:"pointer"},className:"col-".concat(a," text-danger ").concat(r?"":"text-right"),children:[Object(n.jsx)(V.a,{})," Log out"]})},G=function(e){var t=e.user,s=e.col,a=void 0===s?7:s,c=e.noinfo,r=void 0!==c&&c;return Object(n.jsxs)("div",{className:"col-".concat(a," d-flex align-items-center ").concat(r?"justify-content-end":""),children:[Object(n.jsx)("div",{className:"align-self-center ".concat(r?"":"mr-3"),children:Object(n.jsx)(P,{name:t.username,id:t.id})}),!r&&Object(n.jsxs)("div",{className:"media-body",children:[Object(n.jsx)("h5",{className:"font-size-14 mt-0 mb-1",children:t.username}),Object(n.jsxs)("div",{className:"d-flex align-items-center",children:[Object(n.jsx)(W,{online:!0}),Object(n.jsx)("p",{className:"ml-2 text-muted mb-0",children:"Active"})]})]})]})},X=function(e){var t=e.user,s=e.onLogOut;return Object(n.jsx)("div",{className:"row no-gutters align-items-center pl-4 pr-2 pb-3",style:{height:"inherit",flex:0,minHeight:50},children:Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(G,{user:t,col:8}),Object(n.jsx)(q,{onLogOut:s,col:4})]})})},Z=function(e){var t=e.rooms,s=e.dispatch,c=e.user,r=e.currentRoom,o=e.onLogOut,i=Object(a.useMemo)((function(){var e=Object.values(t),s=e.filter((function(e){return"0"===e.id})),n=e.filter((function(e){return"0"!==e.id}));return n=n.sort((function(e,t){return+e.id.split(":").pop()-+t.id.split(":").pop()})),[].concat(Object(O.a)(s||[]),Object(O.a)(n))}),[t]);return Object(n.jsx)(n.Fragment,{children:Object(n.jsxs)("div",{className:"chat-list-container flex-column d-flex pr-4",children:[Object(n.jsx)("div",{className:"py-2",children:Object(n.jsx)("p",{className:"h5 mb-0 py-1 chats-title",children:"Chats"})}),Object(n.jsx)("div",{className:"messages-box flex flex-1",children:Object(n.jsx)("div",{className:"list-group rounded-0",children:i.map((function(e){return Object(n.jsx)(J,{onClick:function(){return s({type:"set current room",payload:e.id})},active:r===e.id,room:e},e.id)}))})}),Object(n.jsx)(X,{user:c,onLogOut:o})]})})},K=function(e){var t=e.message;return Object(n.jsx)("p",{className:"mb-2 fs-6 fw-light fst-italic text-black-50 text-center",style:{opacity:.8,fontSize:14},children:t})},Q=function(){return Object(n.jsx)("div",{className:"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center",children:Object(n.jsx)("div",{className:"spinner-border",role:"status",children:Object(n.jsx)("span",{className:"visually-hidden"})})})},Y=s(134),$=function(){return Object(n.jsxs)("div",{className:"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center",children:[Object(n.jsx)(Y.a,{size:96}),Object(n.jsx)("p",{children:"No messages"})]})},ee=function(){return Object(n.jsxs)("svg",{width:12,height:12,className:"prefix__MuiSvgIcon-root prefix__jss80 prefix__MuiSvgIcon-fontSizeLarge",viewBox:"0 0 24 24","aria-hidden":"true",children:[Object(n.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),Object(n.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]})},te=function(e){var t=e.username,s=void 0===t?"user":t,a=e.message,c=void 0===a?"Lorem ipsum dolor...":a,r=e.date;return Object(n.jsxs)("div",{className:"d-flex",children:[Object(n.jsx)("div",{style:{flex:1}}),Object(n.jsx)("div",{style:{width:"50%"},className:"text-right mb-4",children:Object(n.jsx)("div",{className:"conversation-list d-inline-block bg-light px-3 py-2",style:{borderRadius:12},children:Object(n.jsxs)("div",{className:"ctext-wrap",children:[Object(n.jsx)("div",{className:"conversation-name text-left text-primary mb-1",style:{fontWeight:600},children:s}),Object(n.jsx)("p",{className:"text-left",children:c}),Object(n.jsxs)("p",{className:"chat-time mb-0",children:[Object(n.jsx)(ee,{})," ",k.a.unix(r).format("LT")," "]})]})})})]})},se=function(e){var t=e.user,s=e.message,a=void 0===s?"Lorem ipsum dolor...":s,c=e.date,r=e.onUserClicked;return Object(n.jsxs)("div",{className:"d-flex",children:[Object(n.jsx)("div",{style:{width:"50%"},className:"text-left mb-4",children:Object(n.jsx)("div",{className:"conversation-list d-inline-block px-3 py-2",style:{borderRadius:12,backgroundColor:"rgba(85, 110, 230, 0.1)"},children:Object(n.jsxs)("div",{className:"ctext-wrap",children:[t&&Object(n.jsxs)("div",{className:"conversation-name text-primary d-flex align-items-center mb-1",children:[Object(n.jsx)("div",{className:"mr-2",style:{fontWeight:600,cursor:"pointer"},onClick:r,children:t.username}),Object(n.jsx)(W,{width:7,height:7,online:t.online})]}),Object(n.jsx)("p",{className:"text-left",children:a}),Object(n.jsxs)("p",{className:"chat-time mb-0",children:[Object(n.jsx)(ee,{})," ",k.a.unix(c).format("LT")," "]})]})})}),Object(n.jsx)("div",{style:{flex:1}})]})},ne=function(e){var t=e.messageListElement,s=e.messages,a=e.room,c=e.onLoadMoreMessages,r=e.user,o=e.onUserClicked,i=e.users;return Object(n.jsxs)("div",{ref:t,className:"chat-box-wrapper position-relative d-flex",children:[void 0===s?Object(n.jsx)(Q,{}):0===s.length?Object(n.jsx)($,{}):Object(n.jsx)(n.Fragment,{}),Object(n.jsx)("div",{className:"px-4 pt-5 chat-box position-absolute",children:s&&0!==s.length&&Object(n.jsxs)(n.Fragment,{children:[a.offset&&a.offset>=15?Object(n.jsxs)("div",{className:"d-flex flex-row align-items-center mb-4",children:[Object(n.jsx)("div",{style:{height:1,backgroundColor:"#eee",flex:1}}),Object(n.jsx)("div",{className:"mx-3",children:Object(n.jsx)("button",{"aria-haspopup":"true","aria-expanded":"true",type:"button",onClick:c,className:"btn rounded-button btn-secondary nav-btn",id:"__BVID__168__BV_toggle_",children:"Load more"})}),Object(n.jsx)("div",{style:{height:1,backgroundColor:"#eee",flex:1}})]}):Object(n.jsx)(n.Fragment,{}),s.map((function(e,t){var s=e.message+e.date+e.from+t;return"info"===e.from?Object(n.jsx)(K,{message:e.message},s):+e.from!==+r.id?Object(n.jsx)(se,{onUserClicked:function(){return o(e.from)},message:e.message,date:e.date,user:i[e.from]},s):Object(n.jsx)(te,{username:i[e.from]?i[e.from].username:"",message:e.message,date:e.date},s)}))]})})]})},ae=function(e){var t=e.message,s=e.setMessage,a=e.onSubmit;return Object(n.jsx)("div",{className:"p-3 chat-input-section",children:Object(n.jsxs)("form",{className:"row",onSubmit:a,children:[Object(n.jsx)("div",{className:"col",children:Object(n.jsx)("div",{className:"position-relative",children:Object(n.jsx)("input",{value:t,onChange:function(e){return s(e.target.value)},type:"text",placeholder:"Enter Message...",className:"form-control chat-input"})})}),Object(n.jsx)("div",{className:"col-auto",children:Object(n.jsxs)("button",{type:"submit",className:"btn btn-primary btn-rounded chat-send w-md",children:[Object(n.jsx)("span",{className:"d-none d-sm-inline-block mr-2",children:"Send"}),Object(n.jsx)("svg",{width:13,height:13,viewBox:"0 0 24 24",tabIndex:-1,children:Object(n.jsx)("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z",fill:"white"})})]})})]})})},ce=function(e){var t=y(),s=Object(i.a)(t,2),n=s[0],c=s[1],r=Object(a.useRef)(null),l=n.rooms[n.currentRoom],j=null===l||void 0===l?void 0:l.id,b=null===l||void 0===l?void 0:l.messages,m=Object(a.useState)(""),f=Object(i.a)(m,2),h=f[0],O=f[1],p=Object(a.useCallback)((function(){setTimeout((function(){r.current&&(r.current.scrollTop=0)}),0)}),[]),x=Object(a.useCallback)((function(){r.current&&r.current.scrollTo({top:r.current.scrollHeight})}),[]);Object(a.useEffect)((function(){x()}),[b,x]);var g=Object(a.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E(j,e).then(function(){var e=Object(u.a)(d.a.mark((function e(s){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(n.users,c,s);case 2:c({type:t?"prepend messages":"set messages",payload:{id:j,messages:s}}),t?setTimeout((function(){p()}),10):x();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[c,j,x,p,n.users]);Object(a.useEffect)((function(){void 0!==j&&void 0===b&&g()}),[b,c,j,n.users,n,x,g]),Object(a.useEffect)((function(){r.current&&x()}),[x,j]);var v=function(){var t=Object(u.a)(d.a.mark((function t(s){var a,r,i;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.users[s],void 0!==(r=a.room)){t.next=9;break}return t.next=5,I(s,e.id);case 5:i=t.sent,r=i.id,c({type:"set user",payload:Object(o.a)(Object(o.a)({},a),{},{room:r})}),c({type:"add room",payload:{id:r,name:T(i.names,e.username)}});case 9:c({type:"set current room",payload:r});case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{onLoadMoreMessages:Object(a.useCallback)((function(){g(l.offset,!0)}),[g,l]),onUserClicked:v,message:h,setMessage:O,dispatch:c,room:l,rooms:n.rooms,currentRoom:n.currentRoom,messageListElement:r,roomId:j,users:n.users,messages:b}};function re(e){var t=e.onLogOut,s=e.user,a=e.onMessageSend,c=ce(s),r=c.onLoadMoreMessages,o=c.onUserClicked,i=c.message,l=c.setMessage,d=c.rooms,u=c.room,j=c.currentRoom,b=c.dispatch,m=c.messageListElement,f=c.roomId,h=c.messages,O=c.users;return Object(n.jsx)("div",{className:"container py-5 px-4",children:Object(n.jsxs)("div",{className:"chat-body row overflow-hidden shadow bg-light rounded",children:[Object(n.jsx)("div",{className:"col-4 px-0",children:Object(n.jsx)(Z,{user:s,onLogOut:t,rooms:d,currentRoom:j,dispatch:b})}),Object(n.jsxs)("div",{className:"col-8 px-0 flex-column bg-white rounded-lg",children:[Object(n.jsx)("div",{className:"px-4 py-4",style:{borderBottom:"1px solid #eee"},children:Object(n.jsx)("h2",{className:"font-size-15 mb-0",children:u?u.name:"Room"})}),Object(n.jsx)(ne,{messageListElement:m,messages:h,room:u,onLoadMoreMessages:r,user:s,onUserClicked:o,users:O}),Object(n.jsx)(ae,{message:i,setMessage:l,onSubmit:function(e){e.preventDefault(),a(i.trim(),f),l(""),m.current.scrollTop=m.current.scrollHeight}})]})]})})}function oe(){return Object(n.jsx)("div",{className:"centered-box",children:Object(n.jsx)("div",{className:"spinner-border",role:"status",children:Object(n.jsx)("span",{className:"visually-hidden"})})})}var ie=function(e){var t=e.link;return Object(n.jsx)("a",{href:t,target:"_blank",title:"Github",children:Object(n.jsxs)("svg",{width:24,height:24,viewBox:"0 0 64 64","aria-labelledby":"title","aria-describedby":"desc",role:"img",children:[Object(n.jsx)("path",{"data-name":"layer2",d:"M32 0a32.021 32.021 0 0 0-10.1 62.4c1.6.3 2.2-.7 2.2-1.5v-6c-8.9 1.9-10.8-3.8-10.8-3.8-1.5-3.7-3.6-4.7-3.6-4.7-2.9-2 .2-1.9.2-1.9 3.2.2 4.9 3.3 4.9 3.3 2.9 4.9 7.5 3.5 9.3 2.7a6.93 6.93 0 0 1 2-4.3c-7.1-.8-14.6-3.6-14.6-15.8a12.27 12.27 0 0 1 3.3-8.6 11.965 11.965 0 0 1 .3-8.5s2.7-.9 8.8 3.3a30.873 30.873 0 0 1 8-1.1 30.292 30.292 0 0 1 8 1.1c6.1-4.1 8.8-3.3 8.8-3.3a11.965 11.965 0 0 1 .3 8.5 12.1 12.1 0 0 1 3.3 8.6c0 12.3-7.5 15-14.6 15.8a7.746 7.746 0 0 1 2.2 5.9v8.8c0 .9.6 1.8 2.2 1.5A32.021 32.021 0 0 0 32 0z",fill:"#595F70"}),Object(n.jsx)("path",{"data-name":"layer1",d:"M12.1 45.9c-.1.2-.3.2-.5.1s-.4-.3-.3-.5.3-.2.6-.1c.2.2.3.4.2.5zm1.3 1.5a.589.589 0 0 1-.8-.8.631.631 0 0 1 .7.1.494.494 0 0 1 .1.7zm1.3 1.8a.585.585 0 0 1-.7-.3.6.6 0 0 1 0-.8.585.585 0 0 1 .7.3c.2.3.2.7 0 .8zm1.7 1.8c-.2.2-.5.1-.8-.1-.3-.3-.4-.6-.2-.8a.619.619 0 0 1 .8.1.554.554 0 0 1 .2.8zm2.4 1c-.1.3-.4.4-.8.3s-.6-.4-.5-.7.4-.4.8-.3c.3.2.6.5.5.7zm2.6.2c0 .3-.3.5-.7.5s-.7-.2-.7-.5.3-.5.7-.5c.4.1.7.3.7.5zm2.4-.4q0 .45-.6.6a.691.691 0 0 1-.8-.3q0-.45.6-.6c.5-.1.8.1.8.3z",fill:"#595F70"})]})})},le=function(){var e=Object(a.useState)(null),t=Object(i.a)(e,2),s=t[0],c=t[1];return Object(a.useEffect)((function(){C.a.get(L("/links")).then((function(e){return e.data})).catch((function(e){return null})).then(c)}),[]),Object(n.jsxs)("nav",{className:"navbar navbar-expand-lg navbar-light bg-white",children:[Object(n.jsx)("span",{className:"navbar-brand",children:"Redis chat demo"}),null!==s?Object(n.jsx)("span",{className:"navbar-text",children:s.github&&Object(n.jsx)(ie,{link:s.github})}):Object(n.jsx)(n.Fragment,{})]})},de=s(64),ue=s.n(de),je=function(e,t,s){t({type:"set user",payload:e}),void 0!==s&&t({type:"append message",payload:{id:"0",message:{date:1e4*Math.random(),from:"info",message:s}}})},be=function(){var e=N(),t=Object(i.a)(e,2),s=t[0],n=t[1],c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){},t=arguments.length>1?arguments[1]:void 0,s=Object(a.useState)(!0),n=Object(i.a)(s,2),c=n[0],r=n[1],o=Object(a.useState)(null),l=Object(i.a)(o,2),j=l[0],b=l[1],m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};s(null),n(!0),S(e,t).then((function(e){b(e)})).catch((function(e){return s(e.message)})).finally((function(){return n(!1)}))},f=function(){var e=Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_().then((function(){b(null),t({type:"clear"}),r(!0)}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){c&&z().then((function(t){b(t),r(!1),e(t)}))}),[e,c]),{user:j,onLogIn:m,onLogOut:f,loading:c}}(Object(a.useCallback)((function(e){null!==e&&(s.users[e.id]||n({type:"set user",payload:Object(o.a)(Object(o.a)({},e),{},{online:!0})}))}),[n,s.users]),n),r=c.user,l=c.onLogIn,j=c.onLogOut,b=c.loading,m=function(e,t){var s=Object(a.useState)(!1),n=Object(i.a)(s,2),c=n[0],r=n[1],o=Object(a.useRef)(null),l=o.current;return Object(a.useEffect)((function(){null===e?(null!==l&&l.disconnect(),r(!1)):(null!==l?l.connect():o.current=ue()(),r(!0))}),[e,l]),Object(a.useEffect)((function(){c&&e?(l.on("user.connected",(function(e){je(e,t,"".concat(e.username," connected"))})),l.on("user.disconnected",(function(e){return je(e,t,"".concat(e.username," left"))})),l.on("show.room",(function(s){console.log({user:e}),t({type:"add room",payload:{id:s.id,name:T(s.names,e.username)}})})),l.on("message",(function(e){t({type:"make user online",payload:e.from}),t({type:"append message",payload:{id:void 0===e.roomId?"0":e.roomId,message:e}})}))):l&&(l.off("user.connected"),l.off("user.disconnected"),l.off("user.room"),l.off("message"))}),[c,e,t,l]),[l,c]}(r,n),f=Object(i.a)(m,2),h=f[0],O=f[1];Object(a.useEffect)((function(){if(null!==r)if(O){var e=[];Object.keys(s.rooms).forEach((function(t){var n=s.rooms[t];n.connected||(e.push(Object(o.a)(Object(o.a)({},n),{},{connected:!0})),h.emit("room.join",n.id))})),0!==e.length&&n({type:"set rooms",payload:e})}else{var t=[];Object.keys(s.rooms).forEach((function(e){var n=s.rooms[e];n.connected&&t.push(Object(o.a)(Object(o.a)({},n),{},{connected:!1}))})),0!==t.length&&n({type:"set rooms",payload:t})}}),[r,O,n,h,s.rooms,s.users]),Object(a.useEffect)((function(){0===Object.values(s.rooms).length&&null!==r&&(C.a.get(L("/users/online")).then((function(e){return e.data})).then((function(e){n({type:"append users",payload:e})})),B(r.id).then((function(e){var t=[];e.forEach((function(e){var s=e.id,n=e.names;t.push({id:s,name:T(n,r.username)})})),n({type:"set rooms",payload:t}),n({type:"set current room",payload:"0"})})))}),[n,s.rooms,r]);var p=Object(a.useCallback)((function(e,t){"string"===typeof e&&0!==e.trim().length&&(h||console.error("Couldn't send message"),h.emit("message",{roomId:t,message:e,from:r.id,date:k()(new Date).unix()}))}),[r,h]);return{loading:b,user:r,state:s,dispatch:n,onLogIn:l,onMessageSend:p,onLogOut:j}},me=function(){var e=be(),t=e.loading,s=e.user,a=e.state,c=e.dispatch,r=e.onLogIn,o=e.onMessageSend,i=e.onLogOut;if(t)return Object(n.jsx)(oe,{});var l=!s;return Object(n.jsx)(v.Provider,{value:[a,c],children:Object(n.jsxs)("div",{className:"full-height ".concat(l?"bg-light":""),style:{backgroundColor:l?void 0:"#495057"},children:[Object(n.jsx)(le,{}),l?Object(n.jsx)(f,{onLogIn:r}):Object(n.jsx)(re,{user:s,onMessageSend:o,onLogOut:i})]})})};r.a.render(Object(n.jsx)(me,{}),document.getElementById("root"))},69:function(e,t,s){},70:function(e,t,s){},71:function(e,t,s){},76:function(e,t,s){},79:function(e,t,s){}},[[129,1,2]]]);
//# sourceMappingURL=main.90c51a67.chunk.js.map